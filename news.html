<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="News and press releases from Community Access -- the open source accessibility agents project.">
  <title>News -- Community Access</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* === Page Header === */
    .page-header {
      background: linear-gradient(160deg, var(--ca-indigo-dark) 0%, var(--ca-violet) 50%, var(--ca-indigo) 100%);
      color: var(--ca-gray-50);
      padding: 4rem 0 3rem;
      text-align: center;
    }
    .page-header h1 {
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 800;
      letter-spacing: -0.03em;
      line-height: 1.15;
      margin-bottom: 1rem;
    }
    .page-header p {
      font-size: 1.15rem;
      max-width: 36rem;
      margin: 0 auto;
      opacity: 0.9;
    }

    /* === News List (uses shared .news-grid / .news-card from styles.css) === */
    .news-list-section { padding: 4rem 0; }

    /* === Single Post === */
    .post-content {
      max-width: 52rem;
      margin: 0 auto;
      padding: 3rem 0 5rem;
    }
    .post-content .post-back {
      display: inline-block;
      margin-bottom: 2rem;
      color: var(--ca-indigo-light);
      text-decoration: underline;
      font-weight: 600;
      font-size: 0.95rem;
    }
    .post-content .post-back:hover { text-decoration-thickness: 2px; }
    .post-content h1 {
      font-size: clamp(1.75rem, 3.5vw, 2.5rem);
      font-weight: 800;
      color: var(--ca-gray-900);
      line-height: 1.2;
      margin-bottom: 1rem;
    }
    .post-content .post-meta {
      margin-bottom: 2rem;
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--ca-gray-700);
    }
    .post-content .post-date { color: var(--ca-indigo-light); }
    .post-content .post-type { color: var(--ca-gray-700); }
    .post-body h2 {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--ca-gray-900);
      margin: 2.5rem 0 1rem;
      letter-spacing: -0.01em;
    }
    .post-body h3 {
      font-size: 1.2rem;
      font-weight: 700;
      color: var(--ca-gray-900);
      margin: 2rem 0 0.75rem;
    }
    .post-body p {
      color: var(--ca-gray-700);
      font-size: 1.05rem;
      line-height: 1.8;
      margin-bottom: 1.25rem;
    }
    .post-body ul, .post-body ol {
      margin: 1rem 0 1.25rem 1.5rem;
      color: var(--ca-gray-700);
      font-size: 1.05rem;
      line-height: 1.8;
    }
    .post-body li { margin-bottom: 0.5rem; }
    .post-body strong { color: var(--ca-gray-900); }
    .post-body a { color: var(--ca-indigo-light); text-decoration: underline; text-underline-offset: 2px; }
    .post-body a:hover { text-decoration-thickness: 2px; }
    .post-body code {
      font-family: var(--font-mono);
      background: var(--ca-gray-100);
      padding: 0.15rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .post-body pre {
      background: var(--ca-gray-900);
      color: #e2e8f0;
      padding: 1.25rem 1.5rem;
      border-radius: 10px;
      overflow-x: auto;
      font-family: var(--font-mono);
      font-size: 0.9rem;
      line-height: 1.6;
      margin: 1.5rem 0;
    }
    .post-body pre code {
      background: none;
      padding: 0;
      border-radius: 0;
      font-size: inherit;
      color: inherit;
    }
    @media (prefers-color-scheme: dark) {
      .post-body pre { background: #0f172a; border: 1px solid var(--ca-gray-200); }
    }
    .post-body blockquote {
      border-left: 4px solid var(--ca-indigo-light);
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      background: var(--ca-gray-50);
      border-radius: 0 8px 8px 0;
    }
    .post-body blockquote p { margin-bottom: 0; }

    /* === Pagination === */
    .pagination {
      max-width: 52rem;
      margin: 0 auto 3rem;
      padding-top: 1rem;
    }
    .pagination-list {
      list-style: none;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.35rem;
      flex-wrap: wrap;
    }
    .pagination-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 2.75rem;
      height: 2.75rem;
      padding: 0.5rem 0.85rem;
      border: 2px solid var(--ca-gray-200);
      border-radius: 8px;
      background: var(--ca-white);
      color: var(--ca-gray-800);
      font-family: inherit;
      font-size: 0.95rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: background var(--transition), border-color var(--transition), color var(--transition);
    }
    .pagination-btn:hover {
      background: var(--ca-gray-100);
      border-color: var(--ca-indigo-light);
      color: var(--ca-indigo-light);
    }
    .pagination-btn[aria-current="page"] {
      background: var(--ca-indigo);
      border-color: var(--ca-indigo);
      color: var(--ca-gray-50);
      cursor: default;
    }
    @media (prefers-color-scheme: dark) {
      .pagination-btn[aria-current="page"] {
        background: var(--ca-indigo-light);
        border-color: var(--ca-indigo-light);
        color: #1e1b4b;
      }
    }
    .pagination-btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
    }
    .pagination-btn:disabled:hover {
      background: var(--ca-white);
      border-color: var(--ca-gray-200);
      color: var(--ca-gray-800);
    }
    .pagination-ellipsis {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 2rem;
      height: 2.75rem;
      color: var(--ca-gray-700);
      font-weight: 600;
      user-select: none;
    }

    /* === Loading === */
    .loading {
      text-align: center;
      padding: 4rem 0;
      color: var(--ca-gray-700);
      font-size: 1.1rem;
    }

    @media (max-width: 48rem) {
      .page-header { padding: 3rem 0 2rem; }
      .post-content { padding: 2rem 0 3rem; }
    }
  </style>
</head>
<body>

<a href="#main" class="skip-link">Skip to main content</a>

<header class="site-header">
  <div class="container header-inner">
    <a href="index.html" class="logo" aria-label="Community Access home">
      <span class="logo-mark" aria-hidden="true">CA</span>
      <span class="logo-text">Community Access</span>
    </a>
    <nav class="header-nav" aria-label="Main navigation">
      <ul>
        <li class="nav-dropdown">
          <button class="nav-dropdown-toggle" aria-expanded="false">Accessibility Agents</button>
          <ul class="nav-dropdown-menu">
            <li><a href="docs.html">Documentation</a></li>
            <li><a href="index.html#agents">Agents</a></li>
            <li><a href="index.html#install">Install</a></li>
            <li><a href="index.html#contribute">Contribute</a></li>
          </ul>
        </li>
        <li><a href="index.html#mission">Mission</a></li>
        <li><a href="news.html" aria-current="page">News</a></li>
        <li><a href="index.html#faq">FAQ</a></li>
        <li><a href="https://github.com/Community-Access">GitHub</a></li>
      </ul>
    </nav>
  </div>
</header>

<main id="main">

<div id="page-header-region" class="page-header">
  <div class="container">
    <h1>News</h1>
    <p>Press releases, announcements, and updates from the Community Access project.</p>
  </div>
</div>
  <div class="container">
    <div id="news-content">
      <p class="loading">Loading posts...</p>
    </div>
    <div class="sr-only" aria-live="polite" id="news-status"></div>
  </div>
</main>

<footer class="site-footer">
  <div class="container">
    <div class="footer-inner">
      <div>
        <span style="font-weight:700; font-size:1.1rem;">Community Access</span>
        <p style="color:#b0b8c4; font-size:0.9rem; margin-top:0.25rem;">Making software accessible by default.</p>
      </div>
      <nav aria-label="Footer navigation">
        <ul class="footer-links">
          <li><a href="https://github.com/Community-Access">GitHub Organization</a></li>
          <li><a href="https://github.com/Community-Access/accessibility-agents">Accessibility Agents</a></li>
          <li><a href="https://github.com/Community-Access/accessibility-agents/blob/main/CONTRIBUTING.md">Contribute</a></li>
          <li><a href="https://github.com/Community-Access/accessibility-agents/blob/main/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
        </ul>
      </nav>
    </div>
    <div class="a11y-statement">
      <p>This site is built to meet WCAG 2.2 Level AA. It uses semantic HTML, visible focus indicators, sufficient color contrast, responsive layout, and respects <code>prefers-reduced-motion</code> and <code>prefers-color-scheme</code> preferences. If you encounter an accessibility barrier, please <a href="https://github.com/Community-Access/accessibility-agents/issues" style="color:var(--ca-emerald-light);">open an issue</a>.</p>
    </div>
    <p class="footer-copy">A community project. Licensed under MIT.</p>
  </div>
</footer>

<script>
(function () {
  'use strict';

  // Dropdown menu
  var dropdown = document.querySelector('.nav-dropdown');
  if (dropdown) {
    var toggle = dropdown.querySelector('.nav-dropdown-toggle');
    var menu = dropdown.querySelector('.nav-dropdown-menu');
    function openMenu() { toggle.setAttribute('aria-expanded', 'true'); menu.classList.add('open'); var first = menu.querySelector('a'); if (first) first.focus(); }
    function closeMenu(ret) { toggle.setAttribute('aria-expanded', 'false'); menu.classList.remove('open'); if (ret) toggle.focus(); }
    toggle.addEventListener('click', function () { toggle.getAttribute('aria-expanded') === 'true' ? closeMenu(true) : openMenu(); });
    toggle.addEventListener('keydown', function (e) {
      if (e.key === 'ArrowDown') { e.preventDefault(); openMenu(); }
    });
    menu.addEventListener('keydown', function (e) {
      var links = menu.querySelectorAll('a');
      var idx = Array.prototype.indexOf.call(links, document.activeElement);
      if (e.key === 'ArrowDown') { e.preventDefault(); if (idx < links.length - 1) links[idx + 1].focus(); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); if (idx > 0) links[idx - 1].focus(); else toggle.focus(); }
      else if (e.key === 'Escape') { e.preventDefault(); closeMenu(true); }
    });
    document.addEventListener('click', function (e) { if (!dropdown.contains(e.target)) closeMenu(false); });
  }

  // Simple markdown to HTML converter
  function md(text) {
    // Remove the H1 title (first line starting with #) - we render it separately
    var lines = text.split('\n');
    var titleLine = -1;
    for (var i = 0; i < lines.length; i++) {
      if (lines[i].match(/^# /)) { titleLine = i; break; }
    }
    if (titleLine >= 0) lines.splice(titleLine, 1);
    text = lines.join('\n');

    var html = text
      // Code blocks
      .replace(/```(\w*)\n([\s\S]*?)```/g, function (m, lang, code) {
        return '<pre><code>' + code.replace(/</g, '&lt;').replace(/>/g, '&gt;').trim() + '</code></pre>';
      })
      // Headers
      .replace(/^### (.+)$/gm, '<h3>$1</h3>')
      .replace(/^## (.+)$/gm, '<h2>$1</h2>')
      // Bold
      .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      // Italic
      .replace(/\*(.+?)\*/g, '<em>$1</em>')
      // Links
      .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2">$1</a>')
      // Bare URLs
      .replace(/(^|[^"(])((https?:\/\/)[^\s<]+)/gm, '$1<a href="$2">$2</a>')
      // Unordered lists
      .replace(/^- (.+)$/gm, '<li>$1</li>')
      // Inline code
      .replace(/`([^`]+)`/g, '<code>$1</code>')
      // Paragraphs
      .replace(/\n\n+/g, '\n\n');

    // Wrap loose li elements in ul
    html = html.replace(/((?:<li>.*<\/li>\n?)+)/g, '<ul>$1</ul>');

    // Wrap remaining text blocks in p tags
    var blocks = html.split('\n\n');
    html = blocks.map(function (block) {
      block = block.trim();
      if (!block) return '';
      if (block.match(/^<(h[23]|ul|ol|pre|blockquote)/)) return block;
      if (block.match(/^<li/)) return '<ul>' + block + '</ul>';
      return '<p>' + block.replace(/\n/g, '<br>') + '</p>';
    }).join('\n');

    return html;
  }

  // Format date
  function formatDate(dateStr) {
    var d = new Date(dateStr + 'T12:00:00');
    var months = ['January','February','March','April','May','June','July','August','September','October','November','December'];
    return months[d.getMonth()] + ' ' + d.getDate() + ', ' + d.getFullYear();
  }

  // Get slug from URL hash
  function getSlug() {
    var hash = window.location.hash;
    if (hash && hash.indexOf('#post/') === 0) return hash.substring(6);
    return null;
  }

  var container = document.getElementById('news-content');
  var headerRegion = document.getElementById('page-header-region');
  var POSTS_PER_PAGE = 6;

  // Get current page from URL query parameter
  function getCurrentPage() {
    var params = new URLSearchParams(window.location.search);
    var p = parseInt(params.get('page'), 10);
    return (p && p > 0) ? p : 1;
  }

  // Update URL without full reload
  function setPageURL(page) {
    var url = new URL(window.location);
    if (page <= 1) {
      url.searchParams.delete('page');
    } else {
      url.searchParams.set('page', page);
    }
    // Remove hash when on list view
    url.hash = '';
    history.pushState(null, '', url);
  }

  // Build pagination range with ellipsis
  function getPageRange(current, total) {
    if (total <= 7) {
      var arr = [];
      for (var i = 1; i <= total; i++) arr.push(i);
      return arr;
    }
    var pages = [1];
    var start = Math.max(2, current - 1);
    var end = Math.min(total - 1, current + 1);
    if (start > 2) pages.push('...');
    for (var j = start; j <= end; j++) pages.push(j);
    if (end < total - 1) pages.push('...');
    pages.push(total);
    return pages;
  }

  // Fetch posts manifest
  fetch('posts/posts.json')
    .then(function (r) { return r.json(); })
    .then(function (posts) {
      // Sort by date descending
      posts.sort(function (a, b) { return b.date.localeCompare(a.date); });

      function renderList() {
        headerRegion.querySelector('h1').textContent = 'News';
        document.title = 'News -- Community Access';

        if (posts.length === 0) {
          container.innerHTML = '<p class="loading">No posts yet. Check back soon.</p>';
          return;
        }

        var currentPage = getCurrentPage();
        var totalPages = Math.ceil(posts.length / POSTS_PER_PAGE);
        if (currentPage > totalPages) currentPage = totalPages;
        var startIdx = (currentPage - 1) * POSTS_PER_PAGE;
        var pagePosts = posts.slice(startIdx, startIdx + POSTS_PER_PAGE);

        var html = '<div class="news-list-section"><div class="news-grid">';
        pagePosts.forEach(function (post) {
          html += '<article class="news-card">';
          html += '<div class="news-card-meta">';
          html += '<time class="news-card-date" datetime="' + post.date + '">' + formatDate(post.date) + '</time>';
          if (post.type) html += '<span class="news-badge news-badge-type">' + post.type + '</span>';
          html += '</div>';
          html += '<h2 class="news-card-title"><a href="#post/' + post.slug + '">' + post.title + '</a></h2>';
          html += '<p class="news-card-summary">' + post.summary + '</p>';
          html += '</article>';
        });
        html += '</div></div>';

        // Pagination controls
        if (totalPages > 1) {
          html += '<nav class="pagination" aria-label="News pagination">';
          html += '<ul class="pagination-list">';
          html += '<li><button class="pagination-btn" data-page="' + (currentPage - 1) + '"' + (currentPage === 1 ? ' disabled' : '') + ' aria-label="Previous page">Previous</button></li>';
          var range = getPageRange(currentPage, totalPages);
          range.forEach(function (p) {
            if (p === '...') {
              html += '<li><span class="pagination-ellipsis" aria-hidden="true">&hellip;</span></li>';
            } else {
              html += '<li><button class="pagination-btn" data-page="' + p + '"';
              if (p === currentPage) html += ' aria-current="page"';
              html += ' aria-label="Page ' + p + '">' + p + '</button></li>';
            }
          });
          html += '<li><button class="pagination-btn" data-page="' + (currentPage + 1) + '"' + (currentPage === totalPages ? ' disabled' : '') + ' aria-label="Next page">Next</button></li>';
          html += '</ul>';
          html += '</nav>';
        }

        container.innerHTML = html;

        // Bind pagination clicks
        var buttons = container.querySelectorAll('.pagination-btn[data-page]');
        buttons.forEach(function (btn) {
          btn.addEventListener('click', function () {
            if (btn.disabled) return;
            var page = parseInt(btn.getAttribute('data-page'), 10);
            if (page === currentPage) return;
            setPageURL(page);
            renderList();
            window.scrollTo(0, 0);
            // Focus the newly active page button in the pagination
            var active = container.querySelector('.pagination-btn[aria-current="page"]');
            if (active) { active.focus(); }
          });
        });

        var ns = document.getElementById('news-status');
        if (ns) ns.textContent = 'Page ' + currentPage + ' of ' + totalPages + ', showing ' + pagePosts.length + ' articles';
      }

      function renderPost(slug) {
        var post = null;
        for (var i = 0; i < posts.length; i++) {
          if (posts[i].slug === slug) { post = posts[i]; break; }
        }
        if (!post) {
          container.innerHTML = '<div class="post-content"><p>Post not found. <a href="news.html">Back to News</a></p></div>';
          return;
        }

        document.title = post.title + ' -- Community Access';
        headerRegion.querySelector('h1').textContent = post.type || 'News';

        container.innerHTML = '<div class="post-content"><p class="loading">Loading article...</p></div>';

        fetch('posts/' + slug + '.md')
          .then(function (r) { return r.text(); })
          .then(function (text) {
            // Extract title from first H1
            var titleMatch = text.match(/^# (.+)$/m);
            var title = titleMatch ? titleMatch[1] : post.title;

            var html = '<article class="post-content">';
            html += '<a href="news.html" class="post-back">Back to News</a>';
            html += '<h1>' + title + '</h1>';
            html += '<p class="post-meta"><time class="post-date" datetime="' + post.date + '">' + formatDate(post.date) + '</time>';
            if (post.type) html += ' <span class="post-type">' + post.type + '</span>';
            html += '</p>';
            html += '<div class="post-body">' + md(text) + '</div>';
            html += '</article>';
            container.innerHTML = html;
            var heading = container.querySelector('h1');
            if (heading) { heading.setAttribute('tabindex', '-1'); heading.focus(); }
            var ns = document.getElementById('news-status');
            if (ns) ns.textContent = 'Loaded: ' + title;
            window.scrollTo(0, 0);
          })
          .catch(function () {
            container.innerHTML = '<div class="post-content"><p>Error loading article. <a href="news.html">Back to News</a></p></div>';
          });
      }

      // Route
      function route() {
        var slug = getSlug();
        if (slug) {
          renderPost(slug);
        } else {
          renderList();
        }
      }

      route();
      window.addEventListener('hashchange', route);
      window.addEventListener('popstate', function () {
        if (!getSlug()) renderList();
      });
    })
    .catch(function () {
      container.innerHTML = '<p class="loading">Unable to load posts. Please try again later.</p>';
    });
})();
</script>
</body>
</html>
